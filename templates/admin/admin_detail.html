{% extends "admin/adminbase.html" %}
{% block title %}Office Admin Details - Campus Admin{% endblock %}

{% block content %}
<div class="space-y-6 animate-[fadeIn_.4s_ease-out]">
  <!-- Back Button -->
  <div>
    <a href="{{ url_for('admin.office_stats') }}"
       class="inline-flex items-center px-4 py-2 rounded-xl border border-gray-200 bg-white text-gray-700 hover:text-blue-700 hover:border-blue-200 shadow-sm hover:shadow transition-all duration-300 group">
      <i class="fas fa-arrow-left mr-2 transition-transform duration-300 group-hover:-translate-x-1"></i>
      Back to Office Statistics
    </a>
  </div>

  {% if admin %}
  <!-- Hero / Header -->
  <div class="relative rounded-3xl overflow-hidden bg-gradient-to-br from-blue-900 via-indigo-900 to-sky-900 text-white shadow-2xl">
    <div class="absolute inset-0 opacity-10 pointer-events-none">
      <div class="absolute -top-10 -left-10 w-48 h-48 rounded-full border-2 border-white/30"></div>
      <div class="absolute bottom-0 right-10 w-24 h-24 rounded-full border-2 border-white/20"></div>
    </div>
    <div class="relative p-6 lg:p-8">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
        <div class="flex items-center">
          <div class="w-20 h-20 lg:w-24 lg:h-24 rounded-2xl overflow-hidden bg-white/10 border-2 border-white/20 flex items-center justify-center shadow-lg ring-1 ring-white/20">
            {% if admin.user.profile_pic %}
            <img src="{{ url_for('static', filename=admin.user.profile_pic) }}" alt="Profile"
                 class="w-full h-full object-cover" />
            {% else %}
            <span class="text-3xl font-bold">{{ admin.user.first_name[0] }}{{ admin.user.last_name[0] }}</span>
            {% endif %}
          </div>
          <div class="ml-4 lg:ml-6">
            <h1 class="text-2xl lg:text-3xl font-bold tracking-tight">{{ admin.user.get_full_name() }}</h1>
            <div class="mt-1 text-blue-100 flex items-center space-x-3">
              <span class="text-sm"><i class="fas fa-envelope mr-1"></i>{{ admin.user.email }}</span>
              <span class="text-blue-200">â€¢</span>
              <span class="text-sm flex items-center"><i class="fas fa-briefcase mr-1"></i>{{ admin.office.name }}</span>
            </div>
            <div class="mt-3">
              <span class="px-3 py-1 inline-flex items-center text-xs font-semibold rounded-full
                {% if admin.user.is_active %}bg-emerald-100 text-emerald-800 ring-1 ring-emerald-200{% else %}bg-rose-100 text-rose-800 ring-1 ring-rose-200{% endif %}">
                <span class="w-2 h-2 rounded-full mr-2 {% if admin.user.is_active %}bg-emerald-500{% else %}bg-rose-500{% endif %}"></span>
                {{ 'Active' if admin.user.is_active else 'Inactive' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-3 gap-3 lg:gap-4">
          <div class="bg-white/10 backdrop-blur-sm rounded-2xl px-4 py-3 border border-white/20">
            <div class="text-xs text-blue-100 mb-1 flex items-center"><i class="fas fa-question-circle mr-1"></i>Total Inquiries</div>
            <div class="text-2xl font-bold">{{ admin.office.inquiries|length }}</div>
          </div>
          <div class="bg-white/10 backdrop-blur-sm rounded-2xl px-4 py-3 border border-white/20">
            <div class="text-xs text-blue-100 mb-1 flex items-center"><i class="fas fa-bullhorn mr-1"></i>Announcements</div>
            <div class="text-2xl font-bold">{{ admin.user.announcements|length }}</div>
          </div>
          <div class="bg-white/10 backdrop-blur-sm rounded-2xl px-4 py-3 border border-white/20">
            <div class="text-xs text-blue-100 mb-1 flex items-center"><i class="fas fa-user-friends mr-1"></i>Counseling</div>
            <div class="text-2xl font-bold">{{ admin.user.counseling_sessions|length }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Sidebar Card -->
    <aside class="lg:col-span-1">
      <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6 sticky top-24 animate-[riseIn_.5s_ease-out]">
        <div class="space-y-3">
          <div class="flex justify-between text-sm">
            <span class="text-gray-500">Role</span>
            <span class="font-medium text-gray-900">Office Admin</span>
          </div>
          <div class="flex justify-between text-sm border-t border-gray-100 pt-3">
            <span class="text-gray-500">Assigned Since</span>
            <span class="font-medium text-gray-900">{{ admin.user.created_at.strftime('%Y-%m-%d') }}</span>
          </div>
          <div class="flex justify-between text-sm border-t border-gray-100 pt-3">
            <span class="text-gray-500">Last Login</span>
            <span class="font-medium text-gray-900">
              {% if admin.user.last_activity %}
                {{ admin.user.last_activity.strftime('%Y-%m-%d %H:%M') }}
              {% else %}
                Never
              {% endif %}
            </span>
          </div>
        </div>

        <div class="mt-6 space-y-2">
          <a href="{{ url_for('admin.edit_office_admin', admin_id=admin.id) }}"
             class="w-full inline-flex items-center justify-center px-4 py-2.5 rounded-xl bg-blue-600 text-white font-medium shadow hover:bg-blue-700 transition-colors">
            <i class="fas fa-edit mr-2"></i> Edit Admin
          </a>
          {% if admin.user.is_active %}
          <button onclick="confirmDeactivate({{ admin.id }})"
             class="w-full inline-flex items-center justify-center px-4 py-2.5 rounded-xl bg-amber-500 text-white font-medium shadow hover:bg-amber-600 transition-colors">
            <i class="fas fa-user-slash mr-2"></i> Deactivate Account
          </button>
          {% endif %}
          <button onclick="confirmUnassign({{ admin.id }})"
             class="w-full inline-flex items-center justify-center px-4 py-2.5 rounded-xl border border-gray-300 bg-white text-gray-700 font-medium shadow-sm hover:bg-gray-50 transition-colors">
            <i class="fas fa-user-minus mr-2"></i> Unassign from Office
          </button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <section class="lg:col-span-2 space-y-6">
      <!-- Tabs -->
      <div class="bg-white rounded-2xl border border-gray-100 shadow-sm">
        <div class="px-4 pt-4">
          <div class="flex space-x-6 relative" id="myTab" role="tablist">
            <button id="details-tab" data-tabs-target="#details" role="tab" aria-controls="details" aria-selected="true"
                    class="tab-btn active py-3 text-sm font-semibold text-blue-700 relative">
              Account Details
              <span class="tab-underline"></span>
            </button>
            <button id="inquiries-tab" data-tabs-target="#inquiries" role="tab" aria-controls="inquiries" aria-selected="false"
                    class="tab-btn py-3 text-sm font-semibold text-gray-500 hover:text-blue-700 relative">
              Activity
              <span class="tab-underline"></span>
            </button>
          </div>
        </div>
        <div class="border-t border-gray-100"></div>

        <!-- Tab Content -->
        <div id="myTabContent" class="p-4 lg:p-6">
          <!-- Details Tab -->
          <div id="details" role="tabpanel" aria-labelledby="details-tab" class="active">
            <div class="grid gap-6">
              <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-6 animate-[fadeIn_.4s_ease-out]">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Personal Information</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div class="p-4 rounded-lg border border-gray-100 bg-gray-50/50">
                    <div class="text-xs uppercase tracking-wide text-gray-500 mb-1 flex items-center">
                      <i class="fas fa-user mr-2 text-gray-400"></i>First Name
                    </div>
                    <div class="text-gray-900 font-medium">{{ admin.user.first_name }}</div>
                  </div>
                  <div class="p-4 rounded-lg border border-gray-100 bg-gray-50/50">
                    <div class="text-xs uppercase tracking-wide text-gray-500 mb-1 flex items-center">
                      <i class="fas fa-user mr-2 text-gray-400"></i>Last Name
                    </div>
                    <div class="text-gray-900 font-medium">{{ admin.user.last_name }}</div>
                  </div>
                  {% if admin.user.middle_name %}
                  <div class="p-4 rounded-lg border border-gray-100 bg-gray-50/50">
                    <div class="text-xs uppercase tracking-wide text-gray-500 mb-1 flex items-center">
                      <i class="fas fa-user-tag mr-2 text-gray-400"></i>Middle Name
                    </div>
                    <div class="text-gray-900 font-medium">{{ admin.user.middle_name }}</div>
                  </div>
                  {% endif %}
                  <div class="p-4 rounded-lg border border-gray-100 bg-gray-50/50">
                    <div class="text-xs uppercase tracking-wide text-gray-500 mb-1 flex items-center">
                      <i class="fas fa-envelope mr-2 text-gray-400"></i>Email Address
                    </div>
                    <div class="flex items-center justify-between">
                      <div class="text-gray-900 font-medium break-all">{{ admin.user.email }}</div>
                      <button type="button" class="ml-3 text-blue-600 hover:text-blue-800 text-sm" onclick="copyText('{{ admin.user.email }}')" title="Copy email">
                        <i class="fas fa-copy"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-6 animate-[fadeIn_.45s_ease-out]">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-gray-900">Office Assignment</h3>
                  <span class="px-2.5 py-1 rounded-full text-xs font-semibold border
                    {% if admin.office.supports_video %}bg-emerald-50 text-emerald-700 border-emerald-200{% else %}bg-gray-50 text-gray-600 border-gray-200{% endif %}">
                    <i class="fas fa-video mr-1"></i>{{ "Video Support" if admin.office.supports_video else "No Video Support" }}
                  </span>
                </div>
                <div class="grid grid-cols-1 gap-6">
                  <div class="flex items-start">
                    <div class="w-10 h-10 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center mr-3">
                      <i class="fas fa-building"></i>
                    </div>
                    <div class="flex-1">
                      <div class="text-xs uppercase tracking-wide text-gray-500">Assigned Office</div>
                      <div class="text-gray-900 font-medium">{{ admin.office.name }}</div>
                    </div>
                  </div>
                  <div class="flex items-start">
                    <div class="w-10 h-10 rounded-lg bg-indigo-50 text-indigo-600 flex items-center justify-center mr-3">
                      <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="flex-1">
                      <div class="text-xs uppercase tracking-wide text-gray-500">Office Description</div>
                      <p id="officeDesc" class="text-gray-900">
                        {{ admin.office.description }}
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-6 animate-[fadeIn_.5s_ease-out]">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Account Status</h3>
                <div class="flex flex-wrap gap-2 mb-4">
                  <span class="px-2.5 py-1 rounded-full text-xs font-semibold border
                    {% if admin.user.is_active %}bg-emerald-50 text-emerald-700 border-emerald-200{% else %}bg-rose-50 text-rose-700 border-rose-200{% endif %}">
                    <i class="fas fa-user-check mr-1"></i>{{ "Active" if admin.user.is_active else "Inactive" }}
                  </span>
                  <span class="px-2.5 py-1 rounded-full text-xs font-semibold border
                    {% if admin.user.account_locked %}bg-amber-50 text-amber-700 border-amber-200{% else %}bg-gray-50 text-gray-600 border-gray-200{% endif %}">
                    <i class="fas fa-lock mr-1"></i>{{ "Locked" if admin.user.account_locked else "Not Locked" }}
                  </span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Account Status</div>
                    <div class="text-gray-900 font-medium">{{ "Active" if admin.user.is_active else "Inactive" }}</div>
                  </div>
                  <div>
                    <div class="text-xs uppercase tracking-wide text-gray-500 mb-1">Account Lock Status</div>
                    <div class="text-gray-900 font-medium">{{ "Locked" if admin.user.account_locked else "Not Locked" }}</div>
                  </div>
                  {% if admin.user.account_locked %}
                  <div class="md:col-span-2">
                    <div class="rounded-xl border border-amber-200 bg-amber-50 p-4">
                      <div class="flex items-start">
                        <div class="mr-3 text-amber-600"><i class="fas fa-triangle-exclamation"></i></div>
                        <div class="flex-1">
                          <div class="font-semibold text-amber-800 mb-1">Account Locked</div>
                          <div class="text-sm text-amber-800"><span class="font-medium">Reason:</span> {{ admin.user.lock_reason or "No reason provided" }}</div>
                          <div class="text-sm text-amber-800 mt-1">On {{ admin.user.locked_at.strftime('%Y-%m-%d %H:%M') }}{% if admin.user.locked_by %} by {{ admin.user.locked_by.get_full_name() }}{% else %} by System{% endif %}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>

          <!-- Activity Tab -->
          <div id="inquiries" role="tabpanel" aria-labelledby="inquiries-tab" class="hidden">
            <div class="grid gap-6">
              <div class="bg-white rounded-xl border border-blue-100 shadow-sm p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Admin Activity Statistics</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2">
                  <div class="rounded-xl p-4 border border-blue-200 bg-blue-50">
                    <div class="flex justify-between items-center mb-2">
                      <h4 class="font-semibold text-blue-800">Total Inquiries</h4>
                      <i class="fas fa-question-circle text-blue-600"></i>
                    </div>
                    <p class="text-3xl font-bold text-blue-700">{{ admin.office.inquiries|length }}</p>
                    <p class="text-sm text-blue-700/80">{{ admin.office.inquiries|selectattr('status', 'equalto', 'pending')|list|length }} pending</p>
                  </div>
                  <div class="rounded-xl p-4 border border-green-200 bg-green-50">
                    <div class="flex justify-between items-center mb-2">
                      <h4 class="font-semibold text-green-800">Announcements</h4>
                      <i class="fas fa-bullhorn text-green-600"></i>
                    </div>
                    <p class="text-3xl font-bold text-green-700">{{ admin.user.announcements|length }}</p>
                  </div>
                  <div class="rounded-xl p-4 border border-purple-200 bg-purple-50">
                    <div class="flex justify-between items-center mb-2">
                      <h4 class="font-semibold text-purple-800">Counseling Sessions</h4>
                      <i class="fas fa-user-friends text-purple-600"></i>
                    </div>
                    <p class="text-3xl font-bold text-purple-700">{{ admin.user.counseling_sessions|length }}</p>
                  </div>
                </div>
              </div>

              <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-6">
                <h4 class="font-semibold text-gray-900 mb-3">Recent Activity</h4>
                {% if admin.user.inquiry_messages or admin.user.announcements %}
                <ul class="relative pl-6 timeline">
                  {% for message in admin.user.inquiry_messages[:5] %}
                  <li class="pb-5 group">
                    <span class="timeline-dot bg-blue-500"></span>
                    <div class="flex items-start">
                      <div class="w-9 h-9 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-3">
                        <i class="fas fa-comment"></i>
                      </div>
                      <div class="flex-1">
                        <div class="flex items-center justify-between">
                          <div class="font-medium text-gray-900">Message</div>
                          <div class="text-xs text-gray-500">{{ message.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                        </div>
                        <div class="text-sm text-gray-700">Response to Inquiry #{{ message.inquiry_id }}</div>
                      </div>
                    </div>
                  </li>
                  {% endfor %}
                  {% for announcement in admin.user.announcements[:3] %}
                  <li class="pb-5 group">
                    <span class="timeline-dot bg-green-500"></span>
                    <div class="flex items-start">
                      <div class="w-9 h-9 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-3">
                        <i class="fas fa-bullhorn"></i>
                      </div>
                      <div class="flex-1">
                        <div class="flex items-center justify-between">
                          <div class="font-medium text-gray-900">Announcement</div>
                          <div class="text-xs text-gray-500">{{ announcement.created_at.strftime('%Y-%m-%d %H:%M') }}</div>
                        </div>
                        <div class="text-sm text-gray-700">{{ announcement.title }}</div>
                      </div>
                    </div>
                  </li>
                  {% endfor %}
                </ul>
                {% else %}
                <div class="text-center py-8 text-gray-500">
                  <i class="fas fa-inbox fa-2x text-gray-400 mb-2"></i>
                  <p>No recent activity found for this admin.</p>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
  {% else %}
  <div class="text-center py-16 bg-white rounded-2xl border border-gray-100 shadow-sm">
    <div class="text-gray-400 mb-3"><i class="fas fa-user-slash fa-3x"></i></div>
    <h2 class="text-xl font-semibold text-gray-800 mb-1">Admin Not Found</h2>
    <p class="text-gray-500">The requested admin could not be found.</p>
    <div class="mt-6">
      <a href="{{ url_for('admin.office_stats') }}" class="px-4 py-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-700 shadow">
        Return to Office Statistics
      </a>
    </div>
  </div>
  {% endif %}
</div>

<!-- Confirmation Modal -->
<div id="confirmationModal" class="fixed inset-0 hidden z-50">
  <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm" onclick="closeModal('confirmationModal')"></div>
  <div class="relative z-10 mx-auto mt-24 w-11/12 md:w-96">
    <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-5 animate-[scaleIn_.18s_ease-out]">
      <div class="flex justify-between items-center pb-3 border-b">
        <h3 class="text-lg font-semibold text-gray-900" id="confirmationTitle">Confirm Action</h3>
        <button type="button" class="text-gray-400 hover:text-gray-600" onclick="closeModal('confirmationModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="mt-4">
        <p class="text-gray-700" id="confirmationMessage">Are you sure you want to perform this action?</p>
      </div>
      <div class="mt-5 flex justify-end gap-2">
        <button type="button" onclick="closeModal('confirmationModal')" class="px-4 py-2 rounded-xl border border-gray-300 bg-white text-gray-700 hover:bg-gray-50">Cancel</button>
        <button type="button" id="confirmActionBtn" class="px-4 py-2 rounded-xl bg-red-600 text-white hover:bg-red-700">Confirm</button>
      </div>
    </div>
  </div>
  </div>
{% endblock %}

{% block extra_js %}
<style>
  @keyframes fadeIn { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
  @keyframes riseIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
  @keyframes scaleIn { from { opacity: 0; transform: scale(0.96);} to { opacity: 1; transform: scale(1);} }
  .tab-btn.active { color: #1e40af; }
  .tab-btn .tab-underline { position:absolute; left:0; bottom:-1px; height:2px; width:0; background:#1e40af; transition: width .25s ease; }
  .tab-btn.active .tab-underline { width:100%; }
  /* Timeline */
  .timeline::before { content:""; position:absolute; left:0.5rem; top:0; bottom:0; width:2px; background:#e5e7eb; }
  .timeline-dot { position:absolute; left:-3px; width:10px; height:10px; border-radius:9999px; top:6px; box-shadow:0 0 0 3px #fff; }
</style>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('[data-tabs-target]');
    const tabContents = document.querySelectorAll('#myTabContent > div');

    tabs.forEach((tab) => {
      tab.addEventListener('click', () => {
        const target = document.querySelector(tab.dataset.tabsTarget);

        // hide others
        tabContents.forEach(c => c.classList.add('hidden'));
        tabs.forEach(t => {
          t.classList.remove('active');
          t.classList.add('text-gray-500');
          t.setAttribute('aria-selected', 'false');
        });

        // activate selected
        tab.classList.add('active');
        tab.classList.remove('text-gray-500');
        tab.setAttribute('aria-selected', 'true');
        target.classList.remove('hidden');
      });
    });
  });

  function openModal(id){ document.getElementById(id).classList.remove('hidden'); }
  function closeModal(id){ document.getElementById(id).classList.add('hidden'); }

  function confirmDeactivate(adminId) {
    document.getElementById('confirmationTitle').textContent = 'Deactivate Admin';
    document.getElementById('confirmationMessage').textContent = 'Are you sure you want to deactivate this admin account? They will no longer be able to login.';

    const btn = document.getElementById('confirmActionBtn');
    btn.className = 'px-4 py-2 rounded-xl bg-amber-500 text-white hover:bg-amber-600';

    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/admin/office_admin/${adminId}/deactivate/`;
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden'; csrfInput.name = 'csrf_token'; csrfInput.value = csrfToken; form.appendChild(csrfInput);
    btn.onclick = function(){ document.body.appendChild(form); form.submit(); closeModal('confirmationModal'); };
    openModal('confirmationModal');
  }

  function confirmActivate(adminId) {
    document.getElementById('confirmationTitle').textContent = 'Activate Admin';
    document.getElementById('confirmationMessage').textContent = 'Are you sure you want to activate this admin account? They will be able to login.';

    const btn = document.getElementById('confirmActionBtn');
    btn.className = 'px-4 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700';

    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/admin/office_admin/${adminId}/activate/`;
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden'; csrfInput.name = 'csrf_token'; csrfInput.value = csrfToken; form.appendChild(csrfInput);
    btn.onclick = function(){ document.body.appendChild(form); form.submit(); closeModal('confirmationModal'); };
    openModal('confirmationModal');
  }

  function confirmUnassign(adminId) {
    document.getElementById('confirmationTitle').textContent = 'Unassign Admin';
    document.getElementById('confirmationMessage').textContent = 'Are you sure you want to unassign this admin from their office?';

    const btn = document.getElementById('confirmActionBtn');
    btn.className = 'px-4 py-2 rounded-xl bg-red-600 text-white hover:bg-red-700';

    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/admin/office_admin/${adminId}/unassign/`;
    const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden'; csrfInput.name = 'csrf_token'; csrfInput.value = csrfToken; form.appendChild(csrfInput);
    btn.onclick = function(){ document.body.appendChild(form); form.submit(); closeModal('confirmationModal'); };
    openModal('confirmationModal');
  }

  function copyText(text){
    try{
      navigator.clipboard.writeText(text);
    }catch(e){
      const ta=document.createElement('textarea');
      ta.value=text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); ta.remove();
    }
  }
</script>
{% endblock %}
