<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}KapiyuGuide - Student Portal{% endblock %}</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/customs.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <!-- Global CSRF token -->
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    {% block extra_head %}{% endblock %}
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      /* Modern gradient backgrounds */
      .navbar-gradient {
        background: linear-gradient(135deg, #1e40af 0%, #3730a3 50%, #4338ca 100%);
        box-shadow: 0 4px 20px rgba(30, 64, 175, 0.3);
      }

      .sidebar-gradient {
        background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
        border-right: 1px solid #e2e8f0;
      }

      .profile-card-gradient {
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 50%, #eff6ff 100%);
        border: 1px solid #93c5fd;
      }

      /* Enhanced sidebar styles */
      .sidebar-item {
        transition: all 0.3s ease;
        border-radius: 0.5rem;
        margin: 0.125rem 0.75rem;
        position: relative;
        overflow: hidden;
      }

      .sidebar-item:hover {
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(30, 64, 175, 0.1);
      }

      .active-nav {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white !important;
        font-weight: 600;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }

      .active-nav:hover {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        transform: translateX(0);
      }

      /* Enhanced notification styles */
      .notification-item {
        transition: all 0.3s ease;
      }
      .notification-item:hover {
        background-color: #f3f4f6;
      }
      .notification-item.unread {
        border-left: 3px solid #3b82f6;
        background-color: rgba(59, 130, 246, 0.05);
      }
      .notification-close {
        opacity: 0;
        transition: opacity 0.2s ease;
      }
      .notification-item:hover .notification-close {
        opacity: 1;
      }
      .notification-content {
        word-break: break-word;
      }      .notification-preview {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      /* Enhanced dropdown styles */
      .dropdown {
        position: relative;
        display: inline-block;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background: white;
        min-width: 200px;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        z-index: 1000;
        border-radius: 0.75rem;
        border: 1px solid #e2e8f0;
        overflow: hidden;
        backdrop-filter: blur(8px);
      }

      .dropdown:hover .dropdown-content {
        display: block;
        animation: fadeInUp 0.2s ease-out;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Enhanced notification badge */
      .notification-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        font-size: 10px;
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        border-radius: 50%;
        padding: 3px 6px;
        font-weight: 600;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%, 100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }      /* Shortcut cards styles */
      .shortcut-card {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 2px solid #0ea5e9;
        border-radius: 1rem;
        transition: all 0.3s ease;
        cursor: pointer;
        overflow: hidden;
        position: relative;
        box-shadow: 0 4px 12px rgba(14, 165, 233, 0.15);
      }

      .shortcut-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(14, 165, 233, 0.25);
        border-color: #0284c7;
      }

      .shortcut-card.inquiry-card {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border-color: #f59e0b;
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.15);
      }

      .shortcut-card.inquiry-card:hover {
        border-color: #d97706;
        box-shadow: 0 15px 35px rgba(245, 158, 11, 0.25);
      }

      .shortcut-card.counseling-card {
        background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
        border-color: #10b981;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
      }

      .shortcut-card.counseling-card:hover {
        border-color: #059669;
        box-shadow: 0 15px 35px rgba(16, 185, 129, 0.25);
      }

      /* Enhanced shortcut icons */
      .shortcut-icon {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
        border: 2px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .shortcut-card:hover .shortcut-icon {
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }

      /* Quick stats styles */
      .quick-stats {
        background: linear-gradient(135deg, #fafafa 0%, #f4f4f5 100%);
        border: 1px solid #e4e4e7;
        border-radius: 1rem;
        padding: 1rem;
        margin: 0.5rem 0;
        transition: all 0.3s ease;
      }

      .quick-stats:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
      }

      .stat-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid #f4f4f5;
      }

      .stat-item:last-child {
        border-bottom: none;
      }

      .stat-value {
        font-weight: 700;
        font-size: 1.1rem;
      }

      /* Counter badges */
      .counter-badge {
        font-size: 10px;
        font-weight: 600;
        border-radius: 1rem;
        padding: 2px 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .counter-red {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
      }

      .counter-blue {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        color: white;
      }

      .counter-green {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
      }

      /* Profile section enhancements */
      .profile-section {
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        border: 1px solid #93c5fd;
        border-radius: 1rem;
        margin: 1rem;
        padding: 1rem;
        box-shadow: 0 4px 12px rgba(30, 64, 175, 0.1);
      }

      /* Navigation section headers */
      .nav-section-header {
        color: #64748b;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 0.75rem 1rem 0.5rem;
        border-bottom: 1px solid #e2e8f0;
        margin-bottom: 0.5rem;
        background: linear-gradient(90deg, #f8fafc 0%, transparent 100%);
      }

      /* Status indicator improvements */
      .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        position: absolute;
        bottom: -2px;
        right: -2px;
      }

      .status-online {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        animation: statusPulse 2s infinite;
      }

      @keyframes statusPulse {
        0%, 100% {
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 0 0 0 rgba(16, 185, 129, 0.7);
        }
        50% {
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 0 0 4px rgba(16, 185, 129, 0);
        }
      }

      /* Main content area */
      .main-content {
        background: #f8fafc;
        border-radius: 1rem 0 0 0;
        overflow: hidden;
      }
    </style>
  </head>  <body class="bg-gray-50 flex flex-col h-screen overflow-hidden">
    <!-- Top Navigation Bar -->
    <header class="navbar-gradient text-white shadow-md relative z-30">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center py-3">
          <div class="flex items-center space-x-4">
            <!-- Mobile menu button -->
            <button
              id="mobileMenuBtn"
              class="md:hidden text-white focus:outline-none"
            >
              <i class="fas fa-bars text-xl"></i>
            </button>

            <!-- Logo -->
            <a
              href="{{ url_for('student.dashboard') }}"
              class="flex items-center"
            >
              <img
                src="/static/images/schoollogo.png"
                alt="KapiyuGuide Logo"
                class="h-10 w-10 rounded-full border-2 border-white/20 shadow-lg"
              />
              <div class="ml-3">
                <span class="text-xl font-bold tracking-tight">KapiyuGuide</span>
                <p class="text-sm text-blue-100 font-medium">Student Portal</p>
              </div>
            </a>
          </div>

          <div class="flex items-center space-x-6">
            <div class="hidden md:flex items-center space-x-2 bg-white/10 rounded-full px-4 py-2 backdrop-blur-sm">
              <i class="fas fa-user-graduate text-blue-200"></i>
              <span class="text-sm font-medium">
                Welcome, <span class="font-bold">{{ current_user.first_name }}!</span>
              </span>
            </div>

            <!-- Notifications Dropdown -->
            <div class="dropdown relative" id="notificationsDropdown">
              <button class="text-white focus:outline-none relative">
                <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all duration-200">
                  <i class="fas fa-bell text-lg"></i>
                  {% if unread_notifications_count and unread_notifications_count > 0 %}
                  <span class="notification-badge">{{ unread_notifications_count }}</span>
                  {% endif %}
                </div>
              </button>

              <!-- Notifications Panel -->
              <div
                class="dropdown-content w-80 mt-2 text-gray-800"
                id="notificationsPanel"
              >
                <div
                  class="px-4 py-3 bg-gradient-to-r from-blue-50 to-blue-100 font-semibold border-b border-blue-200"
                >
                  <div class="flex items-center justify-between">
                    <div class="flex items-center">
                      <i class="fas fa-bell mr-2 text-blue-600"></i>
                      <span>Notifications</span>
                    </div>
                    <a
                      href="#"
                      class="text-xs text-blue-600 hover:text-blue-800"
                      id="markAllAsRead"
                      >Mark all as read</a
                    >
                  </div>
                </div>
                <div
                  class="max-h-96 overflow-y-auto"
                  id="notificationsContainer"
                >
                  {% if notifications %} {% for notification in notifications %}
                  <div
                    class="notification-item p-3 border-b hover:bg-gray-50 {% if not notification.is_read %}unread{% endif %} cursor-pointer"
                    data-notification-id="{{ notification.id }}"
                    {%
                    if
                    notification.inquiry_id
                    %}
                    data-inquiry-id="{{ notification.inquiry_id }}"
                    {%
                    elif
                    notification.announcement_id
                    %}
                    data-announcement-id="{{ notification.announcement_id }}"
                    {%
                    endif
                    %}
                    {%
                    if
                    notification.source_office_id
                    %}
                    data-office-id="{{ notification.source_office_id }}"
                    {%
                    endif
                    %}
                  >
                    <div class="flex items-start">
                      <div class="flex-shrink-0 pt-1">
                        <i
                          class="fas {% if notification.notification_type == 'inquiry_reply' %}fa-reply {% elif notification.notification_type == 'announcement' %}fa-bullhorn {% elif notification.notification_type == 'status_change' %}fa-sync {% else %}fa-info-circle{% endif %} text-blue-500"
                        ></i>
                      </div>
                      <div class="ml-3 flex-grow notification-content">
                        <div class="text-sm font-medium text-gray-900">
                          {% if notification.source_office %} {% if
                          notification.notification_type == 'inquiry_reply' %}
                          {{ notification.source_office.name }} replied {% elif
                          notification.notification_type == 'announcement' %}
                          New Announcement from {{
                          notification.source_office.name }} {% elif
                          notification.notification_type == 'status_change' %}
                          {{ notification.source_office.name }} updated status
                          {% else %} {{ notification.title }} {% endif %} {%
                          else %} {{ notification.title }} {% endif %}
                        </div>
                        <div
                          class="text-xs text-gray-600 mt-1 notification-preview"
                        >
                          {{ notification.message }}
                        </div>
                        <div class="text-xs text-gray-400 mt-1">
                          {{ notification.created_at.strftime('%b %d, %Y %H:%M')
                          }}
                        </div>
                      </div>
                      <button
                        class="notification-close text-gray-400 hover:text-gray-600 ml-2"
                        aria-label="Dismiss notification"
                      >
                        <i class="fas fa-times"></i>
                      </button>
                    </div>
                  </div>
                  {% endfor %} {% else %}
                  <div class="p-3 text-center text-gray-500">
                    <i class="far fa-bell-slash text-gray-300 text-lg mb-2"></i>
                    <p>No notifications</p>
                  </div>
                  {% endif %}
                </div>
                <div class="py-2 px-3 bg-gray-100 text-center">
                  <a
                    href="{{ url_for('student.notifications') }}"
                    class="text-sm text-blue-600 hover:underline"
                    >View all notifications</a
                  >
                </div>
              </div>
            </div>

            <!-- User Dropdown -->
            <div class="dropdown" id="userDropdown">
              <button class="text-white focus:outline-none">
                <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all duration-200">
                  {% if current_user.profile_pic %}
                  <img
                    src="{{ current_user.profile_pic }}"
                    alt="Profile"
                    class="w-full h-full rounded-full object-cover"
                  />
                  {% else %}
                  <span class="font-medium text-sm">{{ current_user.first_name[0] }}{{ current_user.last_name[0] }}</span>
                  {% endif %}
                </div>
              </button>

              <!-- User Dropdown Menu -->
              <div class="dropdown-content text-gray-800 mt-2" id="userMenu">
                <div class="px-4 py-3 bg-gradient-to-r from-blue-50 to-blue-100 border-b border-blue-200">
                  <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white text-sm font-bold mr-3">
                      {{ current_user.first_name[0] }}{{ current_user.last_name[0] }}
                    </div>
                    <div>
                      <div class="font-semibold text-gray-800">{{ current_user.first_name }} {{ current_user.last_name }}</div>
                      <div class="text-xs text-gray-500">{{ current_user.role|replace('_', ' ')|title }}</div>
                    </div>
                  </div>
                </div>                <a
                  href="{{ url_for('student.profile') }}"
                  class="block px-4 py-3 hover:bg-blue-50 transition-colors duration-200"
                >
                  <i class="fas fa-user-circle mr-3 text-blue-600"></i> My Profile
                </a>
                <a
                  href="{{ url_for('student.account_settings') }}"
                  class="block px-4 py-3 hover:bg-blue-50 transition-colors duration-200"
                >
                  <i class="fas fa-cog mr-3 text-gray-600"></i> Account Settings
                </a>
                <hr class="my-1">
                <a
                  href="{{ url_for('auth.logout') }}"
                  class="block px-4 py-3 hover:bg-red-50 text-red-600 transition-colors duration-200"
                >                  <i class="fas fa-sign-out-alt mr-3"></i> Logout
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
      <!-- Sidebar - Desktop -->
      <aside class="sidebar-gradient w-72 flex-shrink-0 overflow-y-auto shadow-xl relative z-20" id="sidebar">
        <div class="h-full flex flex-col">          <!-- Student Profile Section -->
          <div class="profile-section">
            <div class="flex items-center">
              <div class="relative mr-4">
                <div class="w-14 h-14 rounded-xl overflow-hidden bg-gradient-to-br from-blue-600 to-blue-700 shadow-lg ring-2 ring-white ring-opacity-60">
                  {% if current_user.profile_pic %}
                  <img
                    src="{{ current_user.profile_pic }}"
                    alt="Profile Picture"
                    class="w-full h-full object-cover"
                  />
                  {% else %}
                  <div class="w-full h-full flex items-center justify-center text-white text-lg font-bold">
                    {{ current_user.first_name[0] }}{{ current_user.last_name[0] }}
                  </div>
                  {% endif %}
                </div>
                <!-- Enhanced status indicator -->
                <div
                  class="status-indicator status-online"
                  title="Online"
                ></div>
              </div>
              <div class="flex-1">
                <h3 class="font-bold text-gray-800 text-base">
                  {{ current_user.first_name }} {{ current_user.last_name }}
                </h3>
                <p class="text-xs text-gray-500 mb-2">{{ current_user.email }}</p>
                <div class="flex items-center space-x-2">
                  <span class="bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs px-3 py-1 rounded-full font-medium shadow-sm">
                    <i class="fas fa-user-graduate mr-1"></i>
                    Student
                  </span>
                  <span class="bg-gradient-to-r from-green-400 to-green-500 text-white text-xs px-2 py-1 rounded-full font-medium shadow-sm" title="Active Status">
                    <i class="fas fa-circle text-xs"></i>
                  </span>
                </div>
              </div>
            </div>
          </div><!-- Quick Action Shortcuts -->          <div class="px-4 py-4">
            <div class="nav-section-header">
              <i class="fas fa-rocket mr-2 text-blue-600"></i>
              Quick Actions
            </div>
            <div class="space-y-2">
              <!-- Submit Inquiry Shortcut -->              <a href="{{ url_for('student.university_offices') }}" class="shortcut-card inquiry-card p-3 block group">
                <div class="flex items-center">
                  <div class="shortcut-icon w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center text-white shadow-lg group-hover:shadow-xl transition-all duration-300">
                    <i class="fas fa-question-circle text-sm"></i>
                  </div>
                  <div class="ml-3 flex-1">
                    <h4 class="font-medium text-amber-800 text-sm group-hover:text-amber-900 transition-colors">Submit Inquiry</h4>
                    <p class="text-xs text-amber-700 mt-0.5 group-hover:text-amber-800 transition-colors">Ask questions and get help</p>
                  </div>
                  <div class="text-amber-600 group-hover:text-amber-700 group-hover:translate-x-1 transition-all duration-300">
                    <i class="fas fa-arrow-right text-sm"></i>
                  </div>
                </div>
              </a><!-- Request Counseling Session Shortcut -->              <a href="{{ url_for('student.request_counseling_session') }}" class="shortcut-card counseling-card p-3 block group">
                <div class="flex items-center">
                  <div class="shortcut-icon w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-emerald-600 flex items-center justify-center text-white shadow-lg group-hover:shadow-xl transition-all duration-300">
                    <i class="fas fa-user-md text-sm"></i>
                  </div>
                  <div class="ml-3 flex-1">
                    <h4 class="font-medium text-green-800 text-sm group-hover:text-green-900 transition-colors">Request Counseling</h4>
                    <p class="text-xs text-green-700 mt-0.5 group-hover:text-green-800 transition-colors">Schedule counseling session</p>
                  </div>
                  <div class="text-green-600 group-hover:text-green-700 group-hover:translate-x-1 transition-all duration-300">
                    <i class="fas fa-arrow-right text-sm"></i>
                  </div>
                </div>
              </a>
            </div>
          </div><!-- Navigation Links -->
          <div class="flex-1 px-2">
            <div class="nav-section-header">
              <i class="fas fa-compass mr-2 text-indigo-600"></i>
              Main Navigation
            </div>

            <nav class="space-y-1">
              <a
                href="{{ url_for('student.dashboard') }}"
                class="sidebar-item flex items-center px-4 py-3 group {% if request.endpoint == 'student.dashboard' %}active-nav{% else %}text-gray-700 hover:text-blue-700{% endif %}"
              >
                <div class="w-8 flex justify-center">
                  <i class="fas fa-tachometer-alt text-lg group-hover:scale-110 transition-transform duration-200"></i>
                </div>
                <span class="ml-3 font-medium">Dashboard</span>
                {% if request.endpoint == 'student.dashboard' %}
                <span class="ml-auto">
                  <i class="fas fa-circle text-xs animate-pulse"></i>
                </span>
                {% endif %}
              </a>

              <a
                href="{{ url_for('student.inquiries') }}"
                class="sidebar-item flex items-center px-4 py-3 group {% if request.endpoint == 'student.inquiries' %}active-nav{% else %}text-gray-700 hover:text-blue-700{% endif %}"
              >
                <div class="w-8 flex justify-center">
                  <i class="fas fa-question-circle text-lg group-hover:scale-110 transition-transform duration-200"></i>
                </div>
                <span class="ml-3 font-medium">My Inquiries</span>
                {% if pending_inquiries and pending_inquiries > 0 %}
                <span class="ml-auto counter-badge counter-red animate-bounce">
                  {{ pending_inquiries }}
                </span>
                {% elif request.endpoint == 'student.inquiries' %}
                <span class="ml-auto">
                  <i class="fas fa-circle text-xs animate-pulse"></i>
                </span>
                {% endif %}
              </a>              <a
                href="{{ url_for('student.counseling_dashboard') }}"
                class="sidebar-item flex items-center px-4 py-3 group {% if request.endpoint == 'student.counseling_dashboard' %}active-nav{% else %}text-gray-700 hover:text-blue-700{% endif %}"
              >
                <div class="w-8 flex justify-center">
                  <i class="fas fa-video text-lg group-hover:scale-110 transition-transform duration-200"></i>
                </div>
                <span class="ml-3 font-medium">My Counseling</span>
                {% if upcoming_sessions and upcoming_sessions > 0 %}
                <span class="ml-auto counter-badge counter-blue animate-pulse">
                  {{ upcoming_sessions }}
                </span>
                {% elif request.endpoint == 'student.counseling_dashboard' %}
                <span class="ml-auto">
                  <i class="fas fa-circle text-xs animate-pulse"></i>
                </span>
                {% endif %}
              </a>

              <a
                href="{{ url_for('student.announcements') }}"
                class="sidebar-item flex items-center px-4 py-3 group {% if request.endpoint == 'student.announcements' %}active-nav{% else %}text-gray-700 hover:text-blue-700{% endif %}"
              >
                <div class="w-8 flex justify-center">
                  <i class="fas fa-bullhorn text-lg group-hover:scale-110 transition-transform duration-200"></i>
                </div>
                <span class="ml-3 font-medium">Announcements</span>
                {% if request.endpoint == 'student.announcements' %}
                <span class="ml-auto">
                  <i class="fas fa-circle text-xs animate-pulse"></i>
                </span>
                {% endif %}
              </a>

              <a
                href="{{ url_for('student.university_offices') }}"
                class="sidebar-item flex items-center px-4 py-3 group {% if request.endpoint == 'student.university_offices' %}active-nav{% else %}text-gray-700 hover:text-blue-700{% endif %}"
              >
                <div class="w-8 flex justify-center">
                  <i class="fas fa-building text-lg group-hover:scale-110 transition-transform duration-200"></i>
                </div>
                <span class="ml-3 font-medium">University Offices</span>
                {% if request.endpoint == 'student.university_offices' %}
                <span class="ml-auto">
                  <i class="fas fa-circle text-xs animate-pulse"></i>
                </span>
                {% endif %}
              </a>
            </nav>
          </div>          <!-- Footer section -->
          <div class="p-4 border-t border-gray-200 bg-gradient-to-r from-gray-50 to-gray-100">
            <div class="text-center">
              <div class="text-xs text-gray-500 mb-2">
                <i class="fas fa-clock mr-1"></i>
                Last Login
              </div>
              <div class="text-sm text-gray-700 font-medium">
                {% if current_user.last_activity %} 
                {{ current_user.last_activity.strftime('%b %d, %Y') }}
                <br>
                <span class="text-xs text-gray-500">{{ current_user.last_activity.strftime('%I:%M %p') }}</span>
                {% else %} 
                <span class="text-blue-600">First Login</span>
                {% endif %}
              </div>
              <div class="mt-3 pt-2 border-t border-gray-200">
                <div class="flex items-center justify-center space-x-4 text-xs text-gray-400">
                  <span title="Connected"><i class="fas fa-wifi text-green-500"></i></span>
                  <span title="Version">v2.1.0</span>
                  <span title="Support"><i class="fas fa-question-circle"></i></span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>      <!-- Mobile Sidebar Overlay -->
      <div
        class="fixed inset-0 bg-black opacity-50 z-20 hidden"
        id="sidebarOverlay"
      ></div>

      <!-- Main Content -->
      <main class="flex-1 overflow-x-hidden overflow-y-auto main-content">
        <div class="container mx-auto px-4 py-6">
          <!-- Flash Messages -->
          {% with messages = get_flashed_messages(with_categories=true) %} {% if
          messages %} 
          <div class="mb-6">
            {% for category, message in messages %}
            <div
              class="mb-3 border-l-4 p-4 rounded-lg shadow-lg backdrop-blur-sm transition-all duration-300 {% if category == 'success' %}border-green-500 bg-gradient-to-r from-green-50 to-green-100 text-green-800 {% elif category == 'error' %}border-red-500 bg-gradient-to-r from-red-50 to-red-100 text-red-800 {% elif category == 'warning' %}border-yellow-500 bg-gradient-to-r from-yellow-50 to-yellow-100 text-yellow-800 {% else %}border-blue-500 bg-gradient-to-r from-blue-50 to-blue-100 text-blue-800{% endif %}"
              role="alert"
            >
              <div class="flex items-start">
                <!-- Icon based on category -->
                <div class="flex-shrink-0 mr-3 mt-0.5">
                  {% if category == 'success' %}
                  <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                    <i class="fas fa-check text-white text-xs"></i>
                  </div>
                  {% elif category == 'error' %}
                  <div class="w-6 h-6 rounded-full bg-red-500 flex items-center justify-center">
                    <i class="fas fa-exclamation text-white text-xs"></i>
                  </div>
                  {% elif category == 'warning' %}
                  <div class="w-6 h-6 rounded-full bg-yellow-500 flex items-center justify-center">
                    <i class="fas fa-exclamation-triangle text-white text-xs"></i>
                  </div>
                  {% else %}
                  <div class="w-6 h-6 rounded-full bg-blue-500 flex items-center justify-center">
                    <i class="fas fa-info text-white text-xs"></i>
                  </div>
                  {% endif %}
                </div>
                <div class="flex-1">
                  <p class="font-medium">{{ message }}</p>
                </div>
                <button
                  class="flex-shrink-0 ml-3 text-gray-400 hover:text-gray-600 transition-colors duration-200"
                  onclick="this.parentElement.parentElement.remove()"
                >
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
            {% endfor %}
          </div>
          {% endif %} {% endwith %} 

          <!-- Main Content Area -->
          {% block content %}{% endblock %}
        </div>
      </main>
    </div>

    <!-- Audio for notifications -->
    <audio
      id="notificationSound"
      src="/static/sounds/notification.mp3"
      preload="auto"
    ></audio>    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById("mobileMenuBtn");
        const sidebar = document.getElementById("sidebar");
        const sidebarOverlay = document.getElementById("sidebarOverlay");

        mobileMenuBtn.addEventListener("click", function () {
          sidebar.classList.toggle("hidden");
          sidebar.classList.toggle("fixed");
          sidebar.classList.toggle("z-30");
          sidebar.classList.toggle("inset-y-0");
          sidebar.classList.toggle("left-0");
          sidebarOverlay.classList.toggle("hidden");
        });

        sidebarOverlay.addEventListener("click", function () {
          sidebar.classList.add("hidden");
          sidebar.classList.remove("fixed", "z-30", "inset-y-0", "left-0");
          sidebarOverlay.classList.add("hidden");
        });

        // Dropdown functionality
        const dropdowns = document.querySelectorAll('.dropdown');
        
        dropdowns.forEach(dropdown => {
          const button = dropdown.querySelector('button');
          const content = dropdown.querySelector('.dropdown-content');
          
          if (button && content) {
            button.addEventListener('click', function(e) {
              e.stopPropagation();
              
              // Close other dropdowns
              dropdowns.forEach(otherDropdown => {
                if (otherDropdown !== dropdown) {
                  const otherContent = otherDropdown.querySelector('.dropdown-content');
                  if (otherContent) {
                    otherContent.style.display = 'none';
                  }
                }
              });
              
              // Toggle current dropdown
              if (content.style.display === 'block') {
                content.style.display = 'none';
              } else {
                content.style.display = 'block';
              }
            });
          }
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
          dropdowns.forEach(dropdown => {
            if (!dropdown.contains(e.target)) {
              const content = dropdown.querySelector('.dropdown-content');
              if (content) {
                content.style.display = 'none';
              }
            }
          });
        });

        // Handle notification clicks - redirect to inquiry
        const notificationItems = document.querySelectorAll(".notification-item");
        notificationItems.forEach((item) => {
          item.addEventListener("click", function (e) {
            // Don't navigate if clicked on close button
            if (e.target.closest(".notification-close")) {
              return;
            }

            // Get inquiry ID and navigate if available
            const inquiryId = this.dataset.inquiryId;
            const announcementId = this.dataset.announcementId;
            if (inquiryId) {
              // Mark as read before navigating
              fetch(`/api/notifications/${this.dataset.notificationId}/dismiss`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "X-CSRFToken": document.querySelector('meta[name="csrf-token"]')?.getAttribute("content") || "",
                },
              })
                .then(() => {
                  window.location.href = `/student/inquiry/${inquiryId}`;
                })
                .catch((error) => {
                  console.error("Error marking notification as read:", error);
                  window.location.href = `/student/inquiry/${inquiryId}`;
                });
            } else if (announcementId) {
              fetch(`/api/notifications/${this.dataset.notificationId}/dismiss`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  "X-CSRFToken": document.querySelector('meta[name="csrf-token"]')?.getAttribute("content") || "",
                },
              })
                .then(() => {
                  window.location.href = `/student/announcement/${announcementId}`;
                })
                .catch((error) => {
                  console.error("Error marking notification as read:", error);
                  window.location.href = `/student/announcement/${announcementId}`;
                });
            }
          });
        });

        // Handle notification dismiss buttons
        const closeButtons = document.querySelectorAll(".notification-close");
        closeButtons.forEach((button) => {
          button.addEventListener("click", function (e) {
            e.preventDefault();
            e.stopPropagation();
            const notificationItem = this.closest(".notification-item");
            const notificationId = notificationItem.dataset.notificationId;

            // Mark as read in the database via fetch API
            fetch(`/api/notifications/${notificationId}/dismiss`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": document.querySelector('meta[name="csrf-token"]')?.getAttribute("content") || "",
              },
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error("Network response was not ok");
                }
                return response.json();
              })
              .then((data) => {
                if (data.success) {
                  // Remove the notification from UI
                  notificationItem.style.height = notificationItem.offsetHeight + "px";
                  setTimeout(() => {
                    notificationItem.style.height = "0";
                    notificationItem.style.padding = "0";
                    notificationItem.style.margin = "0";
                    notificationItem.style.opacity = "0";
                    notificationItem.style.overflow = "hidden";
                  }, 10);

                  // Remove from DOM after animation completes
                  setTimeout(() => {
                    notificationItem.remove();

                    // Update badge count
                    const badges = document.querySelectorAll(".notification-badge");
                    badges.forEach(badge => {
                      let count = parseInt(badge.textContent || "0");
                      if (count > 0) {
                        count--;
                        if (count === 0) {
                          badge.classList.add("hidden");
                        } else {
                          badge.textContent = count;
                        }
                      }
                    });

                    // Show "no notifications" message if this was the last one
                    const container = document.getElementById("notificationsContainer");
                    if (container && !container.querySelector(".notification-item")) {
                      container.innerHTML = `
                        <div class="p-3 text-center text-gray-500">
                          <i class="far fa-bell-slash text-gray-300 text-lg mb-2"></i>
                          <p>No notifications</p>
                        </div>
                      `;
                    }
                  }, 300);
                }
              })
              .catch((error) => console.error("Error dismissing notification:", error));
          });
        });

        // Mark all as read functionality
        const markAllAsReadBtn = document.getElementById("markAllAsRead");
        if (markAllAsReadBtn) {
          markAllAsReadBtn.addEventListener("click", function (e) {
            e.preventDefault();
            fetch("/api/notifications/mark-all-read", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": document.querySelector('meta[name="csrf-token"]')?.getAttribute("content") || "",
              },
            })
              .then((response) => {
                if (!response.ok) {
                  throw new Error("Network response was not ok");
                }
                return response.json();
              })
              .then((data) => {
                if (data.success) {
                  // Update UI - remove 'unread' class from all notifications
                  document.querySelectorAll(".notification-item.unread").forEach((item) => {
                    item.classList.remove("unread");
                  });

                  // Hide the badge counter
                  const badges = document.querySelectorAll(".notification-badge");
                  badges.forEach(badge => {
                    badge.textContent = "0";
                    badge.classList.add("hidden");
                  });

                  // Show confirmation feedback
                  const container = document.getElementById("notificationsContainer");
                  const feedbackDiv = document.createElement("div");
                  feedbackDiv.className = "bg-green-50 text-green-700 text-xs text-center p-2 border-b border-green-100";
                  feedbackDiv.innerText = "All notifications marked as read";
                  container.prepend(feedbackDiv);

                  // Remove the feedback after 2 seconds
                  setTimeout(() => {
                    feedbackDiv.style.opacity = "0";
                    feedbackDiv.style.transition = "opacity 0.5s ease";
                    setTimeout(() => feedbackDiv.remove(), 500);
                  }, 2000);
                }
              })
              .catch((error) => console.error("Error marking notifications as read:", error));
          });
        }

        // WebSocket connection for real-time updates
        const socket = io();
        socket.on("connect", function () {
          console.log("Connected to WebSocket");
          socket.emit("join", { room: "student_room" });
          socket.emit("join", { room: `student_{{ current_user.id }}` });
        });

        // Listen for notification events
        socket.on("new_notification", function (data) {
          // Update notification badge
          const notificationBadges = document.querySelectorAll(".notification-badge");
          notificationBadges.forEach(badge => {
            let count = parseInt(badge.innerText || "0");
            count += 1;
            badge.innerText = count;
            badge.classList.remove("hidden");
          });

          // Add notification to dropdown
          const container = document.getElementById("notificationsContainer");
          if (container) {
            const emptyMessage = container.querySelector(".text-center.text-gray-500");
            if (emptyMessage) {
              container.innerHTML = "";
            }

            // Determine appropriate icon and title based on notification type
            let iconClass = "fa-info-circle";
            let title = data.title || "";

            if (data.notification_type === "inquiry_reply") {
              iconClass = "fa-reply";
              if (data.source_office && data.source_office.name) {
                title = `${data.source_office.name} replied`;
              } else if (data.office_name) {
                title = `${data.office_name} replied`;
              } else {
                title = data.title || "Office replied";
              }
            } else if (data.notification_type === "announcement") {
              iconClass = "fa-bullhorn";
              if (data.source_office && data.source_office.name) {
                title = `New Announcement from ${data.source_office.name}`;
              } else {
                title = data.title || "New Announcement";
              }
            } else if (data.notification_type === "status_change") {
              iconClass = "fa-sync";
              if (data.source_office && data.source_office.name) {
                title = `${data.source_office.name} updated status`;
              } else {
                title = data.title || "Status Updated";
              }
            }

            const messagePreview = data.message && data.message.length > 100 
              ? data.message.substring(0, 100) + "..." 
              : data.message || "";

            const notificationElement = document.createElement("div");
            notificationElement.className = "notification-item p-3 border-b hover:bg-gray-50 unread cursor-pointer";
            notificationElement.dataset.notificationId = data.id || "";

            if (data.inquiry_id) {
              notificationElement.dataset.inquiryId = data.inquiry_id;
            } else if (data.announcement_id) {
              notificationElement.dataset.announcementId = data.announcement_id;
            }

            notificationElement.innerHTML = `
              <div class="flex items-start">
                <div class="flex-shrink-0 pt-1">
                  <i class="fas ${iconClass} text-blue-500"></i>
                </div>
                <div class="ml-3 flex-grow notification-content">
                  <div class="text-sm font-medium text-gray-900">${title}</div>
                  <div class="text-xs text-gray-600 mt-1 notification-preview">${messagePreview}</div>
                  <div class="text-xs text-gray-400 mt-1">Just now</div>
                </div>
                <button class="notification-close text-gray-400 hover:text-gray-600 ml-2" aria-label="Dismiss notification">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            `;

            container.prepend(notificationElement);

            // Play notification sound
            const notificationSound = document.getElementById("notificationSound");
            if (notificationSound) {
              notificationSound.play().catch((e) => console.warn("Could not play notification sound:", e));
            }
          }
        });
      });
    </script>

    {% block scripts %}{% endblock %}
  </body>
</html>