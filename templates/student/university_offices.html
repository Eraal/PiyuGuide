{% extends "student/student_base.html" %}
{% block title %}University Offices - KapiyuGuide{% endblock %}

{% block extra_head %}
<style>
    /* Modern Page Header */
    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow: hidden;
    }
    
    .page-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        opacity: 0.3;
    }

    /* Enhanced Office Cards */
    .office-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border: 1px solid #e2e8f0;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        cursor: pointer; /* Make the whole card feel clickable */
    }
    
    .office-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }
    
    .office-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        border-color: #3b82f6;
    }
    
    .office-card:hover::before {
        transform: scaleX(1);
    }

    /* Enhanced Search Bar */
    .search-container {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border: 2px solid transparent;
        background-clip: padding-box;
        backdrop-filter: blur(10px);
    }
    
    .search-container:focus-within {
        border-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    }

    /* Filter Pills */
    .filter-pill {
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        border: 1px solid #cbd5e1;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .filter-pill::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        transform: scaleX(0);
        transition: transform 0.3s ease;
        z-index: 0;
    }
    
    .filter-pill.active::before {
        transform: scaleX(1);
    }
    
    .filter-pill.active {
        color: white;
        border-color: #3b82f6;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .filter-pill:hover:not(.active) {
        background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .filter-pill span {
        position: relative;
        z-index: 1;
    }

    /* Service Badges */
    .service-badge {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 1px solid #0ea5e9;
        color: #0369a1;
        transition: all 0.2s ease;
    }
    
    .service-badge.counseling {
        background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
        border-color: #22c55e;
        color: #166534;
    }
    
    .service-badge.video {
        background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
        border-color: #8b5cf6;
        color: #6b21a8;
    }
    
    .service-badge:hover {
        transform: scale(1.05);
    }

    /* Featured Section */
    .featured-section {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow: hidden;
    }
    
    .featured-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="dots" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="2" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23dots)"/></svg>');
        opacity: 0.4;
    }

    /* Quick Actions */
    .quick-action-btn {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 1px solid #0ea5e9;
        color: #0369a1;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .quick-action-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
        transform: scaleX(0);
        transition: transform 0.3s ease;
        z-index: 0;
    }
    
    .quick-action-btn:hover::before {
        transform: scaleX(1);
    }
    
    .quick-action-btn:hover {
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
    }
    
    .quick-action-btn span,
    .quick-action-btn i {
        position: relative;
        z-index: 1;
    }

    /* Statistics Cards */
    .stat-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.1);
        border-color: #3b82f6;
    }

    /* Responsive Animations */
    .fade-in-up {
        animation: fadeInUp 0.6s ease-out forwards;
        opacity: 0;
        transform: translateY(30px);
    }
    
    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Interactive Elements */
    .interactive-element {
        transition: all 0.2s ease;
    }
    
    .interactive-element:hover {
        transform: scale(1.02);
    }

    /* Empty State */
    .empty-state {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border: 2px dashed #cbd5e1;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Modern Page Header -->
    <div class="page-header rounded-none md:rounded-b-3xl shadow-lg mb-8 relative">
        <div class="container mx-auto px-4 py-12 relative z-10">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-8">
                <div class="flex-1">
                    <div class="flex items-center mb-4">
                        <div class="w-16 h-16 bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl flex items-center justify-center mr-4 shadow-lg">
                            <i class="fas fa-building text-white text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="text-4xl font-bold text-white mb-2">University Offices</h1>
                            <p class="text-indigo-100 text-lg max-w-2xl">Discover comprehensive services, connect with support offices, and schedule personalized counseling sessions</p>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="grid grid-cols-2 gap-4 w-full lg:w-auto">
                    <div class="stats-display-card rounded-2xl p-4 text-center bg-white bg-opacity-20 backdrop-blur-sm border border-white border-opacity-30 shadow-lg">
                        <div class="text-3xl font-bold text-white mb-1">{{ total_offices if total_offices is defined else offices|length }}</div>
                        <div class="text-indigo-100 text-sm font-medium">Total Offices</div>
                    </div>
                    <div class="stats-display-card rounded-2xl p-4 text-center bg-white bg-opacity-20 backdrop-blur-sm border border-white border-opacity-30 shadow-lg">
                        <div class="text-3xl font-bold text-white mb-1">{{ video_services_count if video_services_count is defined else (video_offices|length if video_offices else 0) }}</div>
                        <div class="text-indigo-100 text-sm font-medium">Video Services</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4">
        <!-- Enhanced Search and Filter Section -->
        <div class="search-container rounded-2xl shadow-lg p-6 mb-8 relative">
            <div class="flex flex-col lg:flex-row gap-6 items-start lg:items-center">
                <!-- Search Bar -->
                <div class="flex-1 w-full lg:w-auto">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-search mr-2 text-indigo-500"></i>Search Offices
                    </label>
                    <div class="relative group">
                        <input
                            type="text"
                            id="office-search"
                            placeholder="Search by office name, services, or keywords..."
                            class="w-full pl-12 pr-4 py-4 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent bg-white text-gray-700 shadow-sm transition-all duration-200"
                        />
                        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                            <i class="fas fa-search text-indigo-400 group-hover:text-indigo-600 transition-colors duration-200"></i>
                        </div>
                        <div class="absolute inset-y-0 right-0 pr-4 flex items-center">
                            <button type="button" id="clear-search" class="text-gray-400 hover:text-gray-600 hidden">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Filter Pills -->
                <div class="w-full lg:w-auto">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-filter mr-2 text-indigo-500"></i>Filter by Services
                    </label>
                    <div class="flex flex-wrap gap-3">
                        <button id="filter-all" class="filter-pill active px-6 py-3 rounded-xl font-medium transition-all duration-300 shadow-sm">
                            <span><i class="fas fa-th-large mr-2"></i>All Offices</span>
                        </button>
                        <button id="filter-video" class="filter-pill px-6 py-3 rounded-xl font-medium transition-all duration-300 shadow-sm">
                            <span><i class="fas fa-video mr-2"></i>Video Counseling</span>
                        </button>
                        <button id="filter-inquiries" class="filter-pill px-6 py-3 rounded-xl font-medium transition-all duration-300 shadow-sm">
                            <span><i class="fas fa-paper-plane mr-2"></i>General Inquiries</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="flex flex-wrap gap-3 mt-6 pt-6 border-t border-gray-200">
                <a href="{{ url_for('student.request_counseling_session') }}" class="quick-action-btn px-6 py-3 rounded-xl font-medium transition-all duration-300 shadow-sm">
                    <i class="fas fa-calendar-plus mr-2"></i>
                    <span>Schedule Counseling</span>
                </a>
                <a href="{{ url_for('student.inquiries') }}" class="quick-action-btn px-6 py-3 rounded-xl font-medium transition-all duration-300 shadow-sm">
                    <i class="fas fa-question-circle mr-2"></i>
                    <span>My Inquiries</span>
                </a>
                <button type="button" id="refresh-offices" class="quick-action-btn px-6 py-3 rounded-xl font-medium transition-all duration-300 shadow-sm">
                    <i class="fas fa-sync-alt mr-2"></i>
                    <span>Refresh</span>
                </button>
            </div>
        </div>

        <!-- Modern Office Grid -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Browse All Offices</h2>
                <div class="text-sm text-gray-500 flex items-center">
                    <span id="office-count">{{ offices|length }}</span> offices available
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="office-grid">
                {% for office in offices %}
                <div class="office-card fade-in-up rounded-2xl shadow-lg hover:shadow-xl group" data-office-id="{{ office.id }}" data-detail-url="{{ url_for('student.view_office_detail', office_id=office.id) }}">
                    <div class="h-full flex flex-col">
                        <!-- Card Header -->
                        <div class="p-6 pb-4">
                            <div class="flex items-start justify-between mb-4">
                                <div class="flex items-center flex-1">
                                    <div class="w-16 h-16 bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl flex items-center justify-center mr-4 shadow-lg group-hover:scale-110 transition-transform duration-300">
                                        <i class="fas fa-building text-white text-xl"></i>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <h3 class="text-xl font-bold text-gray-900 mb-1 group-hover:text-indigo-600 transition-colors duration-200">{{ office.name }}</h3>
                                        <div class="flex items-center text-sm text-gray-500">
                                            <i class="fas fa-map-marker-alt mr-1"></i>
                                            <span>University Campus</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Favorite Button -->
                                <button class="interactive-element w-10 h-10 rounded-full bg-gray-100 hover:bg-indigo-50 flex items-center justify-center transition-all duration-200">
                                    <i class="far fa-heart text-gray-400 hover:text-indigo-500"></i>
                                </button>
                            </div>
                            
                            <!-- Description -->
                            <p class="text-gray-600 text-sm leading-relaxed mb-4 line-clamp-3">
                                {{ office.description|default('Comprehensive support services and guidance for students. Contact us for assistance with your academic and personal needs.')|truncate(120) }}
                            </p>
                        </div>
                        
                        <!-- Services Section -->
                        <div class="px-6 pb-4 flex-1">
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
                                    <i class="fas fa-concierge-bell mr-2 text-indigo-500"></i>Available Services
                                </h4>
                                <div class="flex flex-wrap gap-2">
                                    <span class="service-badge inline-flex items-center px-3 py-1 rounded-full text-xs font-medium">
                                        <i class="fas fa-paper-plane mr-1"></i>General Inquiries
                                    </span>
                                    
                                    {% if office.supports_video %}
                                    <span class="service-badge counseling inline-flex items-center px-3 py-1 rounded-full text-xs font-medium">
                                        <i class="fas fa-user-md mr-1"></i>Counseling
                                    </span>
                                    
                                    <span class="service-badge video inline-flex items-center px-3 py-1 rounded-full text-xs font-medium">
                                        <i class="fas fa-video mr-1"></i>Video Sessions
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Availability Status -->
                            <div class="mb-4">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-600">Status:</span>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2 animate-pulse"></div>
                                        <span class="text-green-600 font-medium">Available</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="p-6 pt-0 mt-auto">
                            <div class="flex gap-3">
                                <a href="{{ url_for('student.submit_inquiry', office_id=office.id) }}"
                                   class="btn-inquiry flex-1 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-200 text-center hover:shadow-lg group-hover:scale-105 flex items-center justify-center">
                                    <i class="fas fa-paper-plane mr-2"></i>
                                    <span>Inquiry</span>
                                </a>

                                {% if office.supports_video %}
                                <a href="{{ url_for('student.request_counseling_session') }}?office_id={{ office.id }}"
                                   class="btn-schedule flex-1 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white px-4 py-3 rounded-xl font-medium transition-all duration-200 text-center hover:shadow-lg group-hover:scale-105 flex items-center justify-center">
                                    <i class="fas fa-calendar-plus mr-2"></i>
                                    <span>Schedule</span>
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <!-- Enhanced Empty State -->
                <div class="col-span-full">
                    <div class="empty-state py-16 text-center rounded-2xl">
                        <div class="max-w-md mx-auto">
                            <div class="w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-6">
                                <i class="fas fa-building text-gray-400 text-3xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-gray-700 mb-3">No offices found</h3>
                            <p class="text-gray-500 mb-6 text-lg">There are currently no university offices registered in the system or none match your search criteria.</p>
                            <div class="space-y-3">
                                <button type="button" onclick="clearFilters()" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                                    <i class="fas fa-undo mr-2"></i>Clear Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Enhanced Video Counseling Services Section -->
        {% if video_offices %}
        <div class="featured-section rounded-3xl shadow-2xl p-8 mb-8 relative">
            <div class="relative z-10">
                <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between mb-8 gap-6">
                    <div class="flex items-center">
                        <div class="w-16 h-16 bg-white bg-opacity-20 backdrop-blur-sm rounded-2xl flex items-center justify-center mr-4 shadow-lg">
                            <i class="fas fa-video text-white text-2xl"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2">Video Counseling Services</h2>
                            <p class="text-indigo-100 text-lg max-w-2xl">Connect with professional counselors remotely through secure video sessions</p>
                        </div>
                    </div>
                    <a href="{{ url_for('student.request_counseling_session') }}" 
                       class="bg-white text-indigo-600 px-6 py-4 rounded-xl hover:bg-gray-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 font-semibold flex items-center">
                        <i class="fas fa-calendar-plus mr-2"></i>
                        <span>Schedule Video Session</span>
                        <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
                
                <!-- Video Services Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for office in video_offices %}
                    <div class="bg-white bg-opacity-10 backdrop-blur-sm rounded-2xl p-6 hover:bg-opacity-20 transition-all duration-300 border border-white border-opacity-20 group">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center flex-1">
                                <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center mr-3 group-hover:scale-110 transition-transform duration-300">
                                    <i class="fas fa-video text-white"></i>
                                </div>
                                <div>
                                    <h3 class="font-bold text-white text-lg group-hover:text-indigo-100 transition-colors duration-200">{{ office.name }}</h3>
                                    <div class="flex items-center text-indigo-200 text-sm">
                                        <div class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse"></div>
                                        <span>Available Online</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <p class="text-indigo-100 text-sm mb-4 leading-relaxed">
                            {{ office.description|truncate(80) if office.description else 'Professional video counseling services available for students.' }}
                        </p>
                        
                        <div class="flex gap-3">
                            <a href="{{ url_for('student.view_office_detail', office_id=office.id) }}" 
                               class="flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 text-center text-sm">
                                <i class="fas fa-info-circle mr-1"></i> Details
                            </a>
                            <a href="{{ url_for('student.request_counseling_session') }}?office_id={{ office.id }}" 
                               class="flex-1 bg-white text-indigo-600 hover:bg-gray-100 px-4 py-2 rounded-lg font-medium transition-all duration-200 text-center text-sm">
                                <i class="fas fa-video mr-1"></i> Schedule
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <!-- Additional Features -->
                <div class="mt-8 pt-8 border-t border-white border-opacity-20">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-star mr-3"></i>Why Choose Video Counseling?
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="flex items-start">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3 mt-1">
                                <i class="fas fa-clock text-white"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-semibold mb-1">Flexible Scheduling</h4>
                                <p class="text-indigo-100 text-sm">Book sessions at your convenience, even outside regular hours</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3 mt-1">
                                <i class="fas fa-shield-alt text-white"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-semibold mb-1">Secure & Private</h4>
                                <p class="text-indigo-100 text-sm">End-to-end encrypted sessions ensuring complete confidentiality</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center mr-3 mt-1">
                                <i class="fas fa-users text-white"></i>
                            </div>
                            <div>
                                <h4 class="text-white font-semibold mb-1">Expert Counselors</h4>
                                <p class="text-indigo-100 text-sm">Qualified professionals ready to support your journey</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
       
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    // DOM Elements
    const searchInput = document.getElementById("office-search");
    const clearSearchBtn = document.getElementById("clear-search");
    const officeCards = document.querySelectorAll(".office-card");
    const officeCount = document.getElementById("office-count");
    const filterButtons = {
        all: document.getElementById("filter-all"),
        video: document.getElementById("filter-video"),
        inquiries: document.getElementById("filter-inquiries")
    };
    const refreshBtn = document.getElementById("refresh-offices");
    
    let currentFilter = 'all';
    let searchTimeout;

    // Initialize animations
    initializeAnimations();
    
    // Search functionality with enhanced UX
    searchInput.addEventListener("input", function () {
        clearTimeout(searchTimeout);
        const searchTerm = this.value.trim();
        
        // Show/hide clear button
        if (searchTerm) {
            clearSearchBtn.classList.remove('hidden');
        } else {
            clearSearchBtn.classList.add('hidden');
        }
        
        // Debounced search
        searchTimeout = setTimeout(() => {
            performSearch(searchTerm);
        }, 300);
    });

    // Clear search functionality
    clearSearchBtn.addEventListener("click", function() {
        searchInput.value = '';
        this.classList.add('hidden');
        performSearch('');
        searchInput.focus();
    });

    // Enhanced filter functionality
    Object.keys(filterButtons).forEach(key => {
        if (filterButtons[key]) {
            filterButtons[key].addEventListener("click", function() {
                setActiveFilter(this, key);
                applyFilter(key);
            });
        }
    });

    // Refresh functionality
    if (refreshBtn) {
        refreshBtn.addEventListener("click", function() {
            const icon = this.querySelector('i');
            const span = this.querySelector('span');
            
            // Add loading state
            icon.classList.add('fa-spin');
            span.textContent = 'Refreshing...';
            this.classList.add('opacity-75', 'cursor-not-allowed');
            
            // Simulate refresh (replace with actual API call)
            setTimeout(() => {
                icon.classList.remove('fa-spin');
                span.textContent = 'Refresh';
                this.classList.remove('opacity-75', 'cursor-not-allowed');
                
                // Show success feedback
                showNotification('Offices updated successfully!', 'success');
            }, 1500);
        });
    }

    // Heart/favorite functionality
    document.querySelectorAll('.fa-heart').forEach(heart => {
        heart.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (this.classList.contains('far')) {
                this.classList.remove('far');
                this.classList.add('fas', 'text-red-500');
                showNotification('Added to favorites', 'success');
            } else {
                this.classList.remove('fas', 'text-red-500');
                this.classList.add('far');
                showNotification('Removed from favorites', 'info');
            }
            
            // Add animation
            this.style.transform = 'scale(1.3)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 200);
        });
    });

    // Functions
    function initializeAnimations() {
        // Trigger fade-in animations
        const elements = document.querySelectorAll('.fade-in-up');
        elements.forEach((el, index) => {
            setTimeout(() => {
                el.style.animationPlayState = 'running';
            }, index * 100);
        });
    }

    function performSearch(searchTerm) {
        let visibleCount = 0;
        const normalizedSearch = searchTerm.toLowerCase();
        
        officeCards.forEach((card) => {
            const officeName = card.querySelector("h3").textContent.toLowerCase();
            const officeDesc = card.querySelector("p").textContent.toLowerCase();
            const services = Array.from(card.querySelectorAll(".service-badge"))
                .map(badge => badge.textContent.toLowerCase())
                .join(" ");

            const isMatch = !searchTerm || 
                           officeName.includes(normalizedSearch) ||
                           officeDesc.includes(normalizedSearch) ||
                           services.includes(normalizedSearch);

            if (isMatch && shouldShowCard(card, currentFilter)) {
                showCard(card);
                visibleCount++;
            } else {
                hideCard(card);
            }
        });
        
        updateOfficeCount(visibleCount);
        
        // Show no results message if needed
        toggleNoResultsMessage(visibleCount === 0);
    }

    function applyFilter(filterType) {
        currentFilter = filterType;
        let visibleCount = 0;
        
        officeCards.forEach((card) => {
            const searchTerm = searchInput.value.toLowerCase();
            const shouldShow = shouldShowCard(card, filterType) && 
                             (searchTerm === '' || cardMatchesSearch(card, searchTerm));
            
            if (shouldShow) {
                showCard(card);
                visibleCount++;
            } else {
                hideCard(card);
            }
        });
        
        updateOfficeCount(visibleCount);
        toggleNoResultsMessage(visibleCount === 0);
    }

    function shouldShowCard(card, filterType) {
        if (filterType === 'all') return true;
        
        const services = Array.from(card.querySelectorAll(".service-badge"))
            .map(badge => badge.textContent.toLowerCase());
        
        switch (filterType) {
            case 'video':
                return services.some(service => service.includes('video') || service.includes('counseling'));
            case 'inquiries':
                return services.some(service => service.includes('inquiries') || service.includes('inquiry'));
            default:
                return true;
        }
    }

    function cardMatchesSearch(card, searchTerm) {
        const officeName = card.querySelector("h3").textContent.toLowerCase();
        const officeDesc = card.querySelector("p").textContent.toLowerCase();
        const services = Array.from(card.querySelectorAll(".service-badge"))
            .map(badge => badge.textContent.toLowerCase())
            .join(" ");
        
        return officeName.includes(searchTerm) ||
               officeDesc.includes(searchTerm) ||
               services.includes(searchTerm);
    }

    function setActiveFilter(button, filterType) {
        // Reset all buttons
        Object.values(filterButtons).forEach(btn => {
            if (btn) {
                btn.classList.remove("active");
            }
        });
        
        // Set active button
        button.classList.add("active");
    }

    function showCard(card) {
        card.style.display = "block";
        card.style.opacity = "0";
        card.style.transform = "translateY(20px)";
        
        // Trigger animation
        requestAnimationFrame(() => {
            card.style.transition = "all 0.3s ease";
            card.style.opacity = "1";
            card.style.transform = "translateY(0)";
        });
    }

    function hideCard(card) {
        card.style.transition = "all 0.3s ease";
        card.style.opacity = "0";
        card.style.transform = "translateY(-20px)";
        
        setTimeout(() => {
            card.style.display = "none";
        }, 300);
    }

    function updateOfficeCount(count) {
        if (officeCount) {
            officeCount.textContent = count;
            
            // Add animation
            officeCount.style.transform = 'scale(1.2)';
            setTimeout(() => {
                officeCount.style.transform = 'scale(1)';
            }, 200);
        }
    }

    function toggleNoResultsMessage(show) {
        let noResultsDiv = document.getElementById('no-results-message');
        
        if (show && !noResultsDiv) {
            noResultsDiv = document.createElement('div');
            noResultsDiv.id = 'no-results-message';
            noResultsDiv.className = 'col-span-full text-center py-16 fade-in-up';
            noResultsDiv.innerHTML = `
                <div class="max-w-md mx-auto">
                    <div class="w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-search text-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-700 mb-3">No offices match your search</h3>
                    <p class="text-gray-500 mb-6">Try adjusting your search terms or clearing the filters to see more results.</p>
                    <button type="button" onclick="clearAllFilters()" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white rounded-xl font-semibold transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                        <i class="fas fa-undo mr-2"></i>Clear All Filters
                    </button>
                </div>
            `;
            document.getElementById('office-grid').appendChild(noResultsDiv);
        } else if (!show && noResultsDiv) {
            noResultsDiv.remove();
        }
    }

    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-xl shadow-lg transform translate-x-full transition-all duration-300 ${
            type === 'success' ? 'bg-green-500 text-white' :
            type === 'error' ? 'bg-red-500 text-white' :
            'bg-blue-500 text-white'
        }`;
        notification.innerHTML = `
            <div class="flex items-center">
                <i class="fas ${type === 'success' ? 'fa-check' : type === 'error' ? 'fa-times' : 'fa-info'} mr-2"></i>
                <span>${message}</span>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Show notification
        requestAnimationFrame(() => {
            notification.style.transform = 'translateX(0)';
        });
        
        // Hide after 3 seconds
        setTimeout(() => {
            notification.style.transform = 'translateX(full)';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Global functions
    window.clearAllFilters = function() {
        searchInput.value = '';
        clearSearchBtn.classList.add('hidden');
        setActiveFilter(filterButtons.all, 'all');
        currentFilter = 'all';
        performSearch('');
    };

    window.clearFilters = window.clearAllFilters;

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + K to focus search
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            searchInput.focus();
        }
        
        // Escape to clear search
        if (e.key === 'Escape' && document.activeElement === searchInput) {
            clearAllFilters();
        }
    });

    // Make the whole card clickable to open details, except when clicking on specific buttons
    document.querySelectorAll('.office-card').forEach(card => {
        const detailUrl = card.getAttribute('data-detail-url');
        if (!detailUrl) return;
        card.addEventListener('click', (e) => {
            // Ignore clicks coming from buttons/links inside the card
            const target = e.target;
            if (target.closest('a') || target.closest('button')) {
                return; // let the inner control handle its own navigation
            }
            // Navigate to office detail
            window.location.href = detailUrl;
        });
    });

    // Prevent card click when pressing the Inquiry or Schedule buttons and add subtle loading state
    document.querySelectorAll('.btn-inquiry, .btn-schedule').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const icon = btn.querySelector('i');
            if (icon) {
                icon.classList.add('fa-spinner', 'fa-spin');
            }
        });
    });
});
</script>
{% endblock %}
