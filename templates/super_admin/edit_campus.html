{% extends "super_admin/base.html" %}

{% block title %}Edit Campus - {{ campus.name }}{% endblock %}

{% block page_title %}Edit Campus{% endblock %}
{% block page_subtitle %}Update details for {{ campus.name }} ({{ campus.code }}){% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto space-y-8">
    <!-- Enhanced Header Section with Campus Info -->
    <div class="relative bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 rounded-3xl shadow-2xl p-8 text-white overflow-hidden">
        <!-- Background decorative elements -->
        <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 animate-pulse"></div>
        <div class="absolute bottom-0 left-0 w-24 h-24 bg-blue-400/20 rounded-full -ml-12 -mb-12 animate-pulse delay-1000"></div>
        <div class="absolute top-1/2 right-1/4 w-16 h-16 bg-purple-400/15 rounded-full animate-bounce delay-500"></div>
        
        <div class="relative z-10">
            <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
                <div class="flex items-center space-x-6">
                    <!-- Campus Icon -->
                    <div class="w-20 h-20 bg-white/20 backdrop-blur-sm rounded-2xl flex items-center justify-center shadow-lg border border-white/30">
                        <span class="text-white font-bold text-2xl">{{ campus.code }}</span>
                    </div>
                    
                    <!-- Campus Info -->
                    <div>
                        <div class="flex items-center space-x-4 mb-2">
                            <h1 class="text-4xl font-bold">Edit Campus</h1>
                            {% if campus.is_active %}
                            <div class="bg-emerald-500/90 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm font-semibold">
                                <i class="fas fa-check-circle mr-2"></i>Active
                            </div>
                            {% else %}
                            <div class="bg-red-500/90 backdrop-blur-sm text-white px-4 py-2 rounded-full text-sm font-semibold">
                                <i class="fas fa-times-circle mr-2"></i>Inactive
                            </div>
                            {% endif %}
                        </div>
                        <p class="text-blue-200 text-lg">{{ campus.name }}</p>
                        <div class="flex items-center text-blue-200 text-sm mt-2">
                            <i class="fas fa-calendar mr-2"></i>
                            Created: {{ campus.created_at.strftime('%B %d, %Y') }}
                        </div>
                    </div>
                </div>
                
                <!-- Navigation Buttons -->
                <div class="flex flex-col sm:flex-row gap-3">
                    <a href="{{ url_for('super_admin.view_campus', campus_id=campus.id) }}" 
                       class="bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105 flex items-center justify-center space-x-2 border border-white/30">
                        <i class="fas fa-eye"></i>
                        <span>View Campus</span>
                    </a>
                    <a href="{{ url_for('super_admin.campus_list') }}" 
                       class="bg-white/10 hover:bg-white/20 backdrop-blur-sm text-white px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105 flex items-center justify-center space-x-2 border border-white/20">
                        <i class="fas fa-arrow-left"></i>
                        <span>Back to List</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="space-y-4">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} bg-{{ 'red' if category == 'error' else 'green' }}-50 border-2 border-{{ 'red' if category == 'error' else 'green' }}-200 rounded-2xl p-4 flex items-center space-x-3 shadow-lg animate-slide-in">
                        <div class="w-8 h-8 bg-{{ 'red' if category == 'error' else 'green' }}-500 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'check' }} text-white text-sm"></i>
                        </div>
                        <div class="text-{{ 'red' if category == 'error' else 'green' }}-800 font-semibold">{{ message }}</div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <!-- Enhanced Form Section -->
    <div class="bg-white/70 backdrop-blur-lg rounded-3xl shadow-2xl border border-white/20 overflow-hidden">
        <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-8 py-6 border-b border-gray-200">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-edit text-white text-xl"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-gray-900">Campus Information</h2>
                    <p class="text-gray-600">Update the campus details below. All fields marked with * are required.</p>
                </div>
            </div>
        </div>

        <form method="POST" id="campusEditForm" class="p-8 space-y-8">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Campus Name -->
                <div class="form-group space-y-2">
                    <label for="name" class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-university text-blue-600 mr-2"></i>
                        Campus Name *
                    </label>
                    <div class="relative">
                        <input type="text" 
                               id="name" 
                               name="name" 
                               value="{{ campus.name }}"
                               required
                               class="w-full px-4 py-4 bg-white border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all duration-300 text-lg font-medium placeholder-gray-400"
                               placeholder="Enter campus name (e.g., LSPU San Pablo Campus)">
                        <div class="absolute inset-y-0 right-0 pr-4 flex items-center">
                            <i id="nameCheck" class="fas fa-check text-green-500 hidden"></i>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">Full name of the campus as it appears in official documents</p>
                </div>

                <!-- Campus Code -->
                <div class="form-group space-y-2">
                    <label for="code" class="block text-sm font-bold text-gray-700 mb-2">
                        <i class="fas fa-tag text-purple-600 mr-2"></i>
                        Campus Code *
                    </label>
                    <div class="relative">
                        <input type="text" 
                               id="code" 
                               name="code" 
                               value="{{ campus.code }}"
                               required
                               maxlength="10"
                               style="text-transform: uppercase;"
                               class="w-full px-4 py-4 bg-white border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-purple-500/20 focus:border-purple-500 transition-all duration-300 text-lg font-bold placeholder-gray-400"
                               placeholder="Enter campus code (e.g., SP, HOST)">
                        <div class="absolute inset-y-0 right-0 pr-4 flex items-center">
                            <i id="codeCheck" class="fas fa-check text-green-500 hidden"></i>
                        </div>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">Short unique identifier (2-10 characters, letters and numbers only)</p>
                </div>
            </div>

            <!-- Campus Address -->
            <div class="form-group space-y-2">
                <label for="address" class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-map-marker-alt text-red-600 mr-2"></i>
                    Campus Address
                </label>
                <textarea id="address" 
                          name="address" 
                          rows="3"
                          class="w-full px-4 py-4 bg-white border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-red-500/20 focus:border-red-500 transition-all duration-300 text-lg placeholder-gray-400 resize-none"
                          placeholder="Enter the complete address of the campus...">{{ campus.address or '' }}</textarea>
                <div class="flex justify-between items-center">
                    <p class="text-sm text-gray-500">Full physical address including city, province, and postal code</p>
                    <span id="addressCounter" class="text-xs text-gray-400"></span>
                </div>
            </div>

            <!-- Campus Description -->
            <div class="form-group space-y-2">
                <label for="description" class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-align-left text-green-600 mr-2"></i>
                    Campus Description
                </label>
                <textarea id="description" 
                          name="description" 
                          rows="4"
                          class="w-full px-4 py-4 bg-white border-2 border-gray-200 rounded-2xl focus:ring-4 focus:ring-green-500/20 focus:border-green-500 transition-all duration-300 text-lg placeholder-gray-400 resize-none"
                          placeholder="Provide a detailed description of the campus, its specializations, facilities, and unique features...">{{ campus.description or '' }}</textarea>
                <div class="flex justify-between items-center">
                    <p class="text-sm text-gray-500">Describe the campus's mission, specializations, and key features</p>
                    <span id="descriptionCounter" class="text-xs text-gray-400"></span>
                </div>
            </div>

            <!-- Campus Status -->
            <div class="form-group space-y-4">
                <label class="block text-sm font-bold text-gray-700 mb-2">
                    <i class="fas fa-toggle-on text-indigo-600 mr-2"></i>
                    Campus Status
                </label>
                <div class="bg-gray-50 rounded-2xl p-6 border-2 border-gray-200">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-4">
                            <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
                                <i class="fas fa-power-off text-white"></i>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-gray-900">Active Status</h4>
                                <p class="text-sm text-gray-600">Controls whether this campus is available for operations</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <span class="text-sm font-medium text-gray-700">Inactive</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" 
                                       id="is_active" 
                                       name="is_active" 
                                       class="sr-only peer"
                                       {% if campus.is_active %}checked{% endif %}>
                                <div class="w-14 h-8 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-6 peer-checked:after:border-white after:content-[''] after:absolute after:top-1 after:left-1 after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-gradient-to-r peer-checked:from-green-400 peer-checked:to-green-600"></div>
                            </label>
                            <span class="text-sm font-medium text-gray-700">Active</span>
                        </div>
                    </div>
                    <div class="mt-4 p-4 bg-blue-50 rounded-xl border border-blue-200">
                        <div class="flex items-start space-x-3">
                            <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                            <div class="text-sm text-blue-800">
                                <p class="font-semibold mb-1">Status Information:</p>
                                <ul class="list-disc list-inside space-y-1 text-blue-700">
                                    <li><strong>Active:</strong> Campus is operational and can be selected by users</li>
                                    <li><strong>Inactive:</strong> Campus is disabled and hidden from public view</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="border-t border-gray-200 pt-8">
                <div class="flex flex-col sm:flex-row gap-4 justify-end">
                    <a href="{{ url_for('super_admin.view_campus', campus_id=campus.id) }}" 
                       class="px-8 py-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold rounded-2xl transition-all duration-300 hover:scale-105 hover:shadow-lg text-center">
                        <i class="fas fa-times mr-2"></i>
                        Cancel
                    </a>
                    
                    <button type="submit" 
                            id="submitBtn"
                            class="px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-semibold rounded-2xl transition-all duration-300 hover:scale-105 hover:shadow-2xl flex items-center justify-center space-x-2">
                        <span id="submitText">
                            <i class="fas fa-save mr-2"></i>
                            Update Campus
                        </span>
                        <div id="loadingSpinner" class="hidden">
                            <i class="fas fa-spinner animate-spin mr-2"></i>
                            Updating...
                        </div>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Enhanced Statistics Section -->
    <div class="bg-white/70 backdrop-blur-lg rounded-2xl shadow-xl border border-white/20 p-8">
        <div class="mb-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-2 flex items-center">
                <i class="fas fa-chart-bar mr-3 text-blue-600"></i>
                Campus Statistics
            </h3>
            <p class="text-gray-600">Current overview of campus resources and activity</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Super Admins -->
            <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl p-6 border-2 border-purple-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-user-shield text-white"></i>
                    </div>
                    <span class="text-3xl font-bold text-purple-700">{{ campus.get_super_admins_count() }}</span>
                </div>
                <h4 class="text-lg font-semibold text-purple-900 mb-1">Super Admins</h4>
                <p class="text-sm text-purple-600">Campus administrators</p>
            </div>

            <!-- Offices -->
            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-6 border-2 border-blue-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-building text-white"></i>
                    </div>
                    <span class="text-3xl font-bold text-blue-700">{{ campus.get_active_offices_count() }}</span>
                </div>
                <h4 class="text-lg font-semibold text-blue-900 mb-1">Offices</h4>
                <p class="text-sm text-blue-600">Registered offices</p>
            </div>

            <!-- Created Date -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-2xl p-6 border-2 border-green-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-calendar-plus text-white"></i>
                    </div>
                    <span class="text-lg font-bold text-green-700">{{ campus.created_at.strftime('%b %Y') }}</span>
                </div>
                <h4 class="text-lg font-semibold text-green-900 mb-1">Established</h4>
                <p class="text-sm text-green-600">{{ campus.created_at.strftime('%B %d, %Y') }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Enhanced JavaScript with Real-time Validation -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('campusEditForm');
    const nameInput = document.getElementById('name');
    const codeInput = document.getElementById('code');
    const addressInput = document.getElementById('address');
    const descriptionInput = document.getElementById('description');
    const submitBtn = document.getElementById('submitBtn');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const submitText = document.getElementById('submitText');
    
    // Real-time validation
    function validateField(input, validationFn, checkIcon) {
        const isValid = validationFn(input.value);
        const icon = document.getElementById(checkIcon);
        
        if (input.value.trim() === '') {
            input.classList.remove('border-green-500', 'border-red-500');
            input.classList.add('border-gray-200');
            icon.classList.add('hidden');
        } else if (isValid) {
            input.classList.remove('border-red-500', 'border-gray-200');
            input.classList.add('border-green-500');
            icon.classList.remove('hidden', 'fa-times', 'text-red-500');
            icon.classList.add('fa-check', 'text-green-500');
        } else {
            input.classList.remove('border-green-500', 'border-gray-200');
            input.classList.add('border-red-500');
            icon.classList.remove('hidden', 'fa-check', 'text-green-500');
            icon.classList.add('fa-times', 'text-red-500');
        }
    }
    
    // Validation functions
    const validateName = (value) => value.trim().length >= 3;
    const validateCode = (value) => value.trim().length >= 2 && /^[A-Z0-9]+$/.test(value.trim());
    
    // Auto-uppercase campus code with validation
    codeInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.toUpperCase();
        validateField(e.target, validateCode, 'codeCheck');
    });
    
    // Validate name input
    nameInput.addEventListener('input', function(e) {
        validateField(e.target, validateName, 'nameCheck');
    });
    
    // Character counters
    const addCharacterCounter = (textareaId, maxLength = null) => {
        const textarea = document.getElementById(textareaId);
        const counter = document.getElementById(textareaId + 'Counter');
        
        const updateCounter = () => {
            const length = textarea.value.length;
            if (maxLength) {
                counter.textContent = `${length}/${maxLength} characters`;
                if (length > maxLength) {
                    counter.classList.add('text-red-500');
                } else {
                    counter.classList.remove('text-red-500');
                }
            } else {
                counter.textContent = `${length} characters`;
            }
        };
        
        textarea.addEventListener('input', updateCounter);
        updateCounter(); // Initial count
    };
    
    // Add character counters
    addCharacterCounter('address');
    addCharacterCounter('description');
    
    // Auto-resize textareas
    const autoResize = (textarea) => {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    };
    
    [addressInput, descriptionInput].forEach(textarea => {
        textarea.addEventListener('input', () => autoResize(textarea));
        autoResize(textarea); // Initial resize
    });
    
    // Enhanced form validation and submission
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Validate required fields
        if (!validateName(nameInput.value)) {
            showNotification('Please enter a valid campus name (at least 3 characters)', 'error');
            nameInput.focus();
            return;
        }
        
        if (!validateCode(codeInput.value)) {
            showNotification('Please enter a valid campus code (2-10 characters, letters and numbers only)', 'error');
            codeInput.focus();
            return;
        }
        
        // Show loading state
        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        loadingSpinner.classList.remove('hidden');
        submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
        
        // Submit the form
        setTimeout(() => {
            form.submit();
        }, 500);
    });
    
    // Initial validation
    validateField(nameInput, validateName, 'nameCheck');
    validateField(codeInput, validateCode, 'codeCheck');
});

// Enhanced notification system
function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification fixed top-4 right-4 z-50 p-4 rounded-2xl shadow-2xl transform translate-x-full transition-all duration-300 max-w-sm`;
    
    // Set type-specific styling
    const typeStyles = {
        success: 'bg-green-50 border-2 border-green-200 text-green-800',
        error: 'bg-red-50 border-2 border-red-200 text-red-800',
        warning: 'bg-yellow-50 border-2 border-yellow-200 text-yellow-800',
        info: 'bg-blue-50 border-2 border-blue-200 text-blue-800'
    };
    
    const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-triangle',
        warning: 'fa-exclamation-triangle',
        info: 'fa-info-circle'
    };
    
    notification.className += ` ${typeStyles[type] || typeStyles.info}`;
    notification.innerHTML = `
        <div class="flex items-center space-x-3">
            <i class="fas ${icons[type] || icons.info} text-lg"></i>
            <div class="font-semibold">${message}</div>
        </div>
    `;
    
    // Add to page
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.classList.remove('translate-x-full');
    }, 100);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        notification.classList.add('translate-x-full');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 5000);
}

// Add keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Ctrl/Cmd + Enter to submit form
    if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('submitBtn').click();
    }
    
    // Escape to cancel
    if (e.key === 'Escape') {
        window.location.href = "{{ url_for('super_admin.view_campus', campus_id=campus.id) }}";
    }
});
</script>
{% endblock %}

{% block extra_css %}
<style>
/* Enhanced form styling */
.form-group {
    transition: all 0.3s ease;
}

.form-group:focus-within {
    transform: translateY(-2px);
}

/* Custom focus effects */
input:focus, textarea:focus {
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    transform: translateY(-1px);
}

/* Smooth animations */
@keyframes slideInFromTop {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.animate-slide-in {
    animation: slideInFromTop 0.3s ease-out;
}

/* Loading states */
.btn-loading {
    position: relative;
    color: transparent;
}

.btn-loading::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    top: 50%;
    left: 50%;
    margin-left: -10px;
    margin-top: -10px;
    border: 2px solid #ffffff;
    border-radius: 50%;
    border-top-color: transparent;
    animation: button-loading-spinner 1s ease infinite;
}

@keyframes button-loading-spinner {
    from {
        transform: rotate(0turn);
    }
    to {
        transform: rotate(1turn);
    }
}

/* Enhanced transitions */
* {
    transition: all 0.2s ease;
}

/* Responsive improvements */
@media (max-width: 640px) {
    .grid {
        grid-template-columns: 1fr;
    }
    
    .flex-col {
        align-items: stretch;
    }
    
    .text-4xl {
        font-size: 2rem;
    }
    
    .p-8 {
        padding: 1.5rem;
    }
}

/* Custom toggle switch styling */
input[type="checkbox"]:checked + div {
    background: linear-gradient(135deg, #10b981, #059669);
}

/* Enhanced card hover effects */
.form-group:hover {
    transform: translateY(-1px);
}

/* Validation styling */
.border-green-500 {
    border-color: #10b981 !important;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.border-red-500 {
    border-color: #ef4444 !important;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}
</style>
{% endblock %}
